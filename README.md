# DNS延迟测试工具

这是一个用于测试DNS服务器响应延迟的Python工具，可以帮助您评估不同DNS服务器的性能，包括支持自定义端口和域名形式的DNS服务器。

## 功能特性

- 测试指定DNS服务器的响应延迟
- 支持自定义端口的DNS服务器
- **支持域名形式的DNS服务器地址**（如：dns.google）
- 多次测试并计算统计数据（成功率、最小/最大/平均延迟）
- **端口连接性测试**功能，帮助诊断连接问题
- **详细的错误分析**，提供具体失败原因和排查建议
- 简洁明了的命令行界面
- 详细的测试结果输出

## 安装依赖

在使用前，需要安装Python和必要的依赖包：

```bash
pip install dnspython
```

## 使用方法

基本语法：

```bash
python "dns delay testing.py" --dns <DNS服务器>[:端口] [选项]
```

### 命令行参数

- `--dns`：DNS服务器地址（必需），支持三种格式：
  - IP地址（如：8.8.8.8）
  - 带端口的IP地址（如：8.8.8.8:532）
  - 域名形式（如：dns.google.com）
- `--domain`：测试域名（默认：baidu.com）
- `--count`：测试次数（默认：5）
- `--timeout`：超时时间（秒，默认：5）
- `-h`, `--help`：显示帮助信息

### 使用示例

```bash
# 使用Google的公共DNS服务器测试（默认端口）
python "dns delay testing.py" --dns 8.8.8.8

# 使用域名形式的DNS服务器测试
python "dns delay testing.py" --dns dns.google.com

# 使用指定端口的DNS服务器测试
python "dns delay testing.py" --dns 8.8.8.8:53 --domain google.com

# 自定义测试次数和超时时间
python "dns delay testing.py" --dns 43.133.224.74:532 --count 10 --timeout 3
```

## 测试原理

DNS延迟测试的原理是通过测量从发送DNS查询请求到接收到响应的时间间隔来评估DNS服务器的响应速度。

具体实现：

1. 对于域名形式的DNS服务器，首先进行域名解析获取IP地址
2. **测试目标端口的连接性**，确认端口是否开放
3. 使用`time.perf_counter()`在DNS查询前后分别记录时间点
4. 向指定的DNS服务器发送A记录查询请求（解析域名的IPv4地址）
5. 计算查询完成后的时间差，并转换为毫秒显示
6. 多次测试后，计算成功率、最小延迟、最大延迟和平均延迟等统计数据
7. 对于失败的测试，**提供详细的错误类型和可能原因分析**

## 输出说明

测试完成后，程序会输出详细的测试结果，包括：

- DNS服务器地址（域名会自动解析为IP地址）和端口
- 端口连接状态（开放/关闭）
- 测试域名
- 测试次数和超时时间
- 每次测试的结果和延迟时间
- 详细的错误信息和可能的原因分析
- 测试汇总统计（成功率、最小/最大/平均延迟）
- 测试开始和结束时间

## 错误分析指南

当测试失败时，程序会提供详细的错误信息和可能的原因分析：

1. **端口连接问题**：
   - 如果提示"无法连接到服务器端口"，可能是防火墙限制或端口未开放

2. **DNS查询超时**：
   - 提示"DNS operation timed out"，可能原因包括：
     - 网络连接不稳定
     - 防火墙限制了DNS查询
     - DNS服务器配置问题
     - 端口开放但DNS服务未正常工作

3. **域名解析失败**：
   - 如果输入的是域名形式DNS服务器，但无法解析为IP地址，可能是本地DNS配置问题

4. **常见解决方法**：
   - 确认DNS服务器地址和端口是否正确
   - 检查本地网络连接是否正常
   - 尝试临时关闭防火墙或安全软件
   - 对于自定义DNS服务器，确认其正确配置并正在运行

## 注意事项

- 测试结果可能受到网络环境的影响，请在稳定的网络环境下进行测试
- 对于公共DNS服务器，建议进行多次测试以获得更准确的结果
- 如果测试失败，程序会显示具体的错误信息和可能的原因分析
- 域名形式的DNS服务器会先被解析为IP地址，然后再进行测试
- 对于某些DNS服务器，即使端口开放，也可能存在DNS服务未正常工作的情况
- 使用不同的测试域名可能会得到不同的延迟结果
